# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

`@mitchallen/grid` is a scoped npm package providing 2D grid implementations (Square, Circle, Hexagon, Triangle) with zero-based indexing. It targets both Node.js and browsers via browserify. Hexagon and Triangle are currently mapped to the Square implementation.

## Commands

- **Build + Test**: `npm test` (runs grunt lint/browserify/uglify, then mocha)
- **Build only**: `grunt` (jshint → browserify → uglify)
- **Watch mode**: `npm run watch` (rebuilds on src changes)
- **Test a specific grid type**: `npm run test-square`, `npm run test-circle`, `npm run test-hexagon`, `npm run test-triangle`, `npm run test-create`
- **Run a single test file**: `npx mocha test/square/square-smoke-test.js --timeout 5000`
- **Run tests matching a pattern**: `npx mocha --recursive -g 'pattern' test/ --timeout 20000`
- **Debug-tagged tests**: `npm run test-debug` (runs tests tagged `@DEBUG`)

Note: `npm test` must pass before pushing — CI runs `npm test` on branch pushes (Node 20, Ubuntu).

## Architecture

- **`src/index.js`** — Main entry point. Exports factory functions: `Square`, `Circle`, `Hexagon`, `Triangle`, and a deprecated `create`.
- **`src/circle.js`** — Circle grid built on `@mitchallen/grid-core`. Models concentric rings where each ring's cell count is calculated from circumference ratios.
- **`@mitchallen/grid-core`** — External dependency providing the base grid class (rows, get/set, fill, clone, isCell, clampRecursive, etc.).
- **`@mitchallen/grid-square`** — External dependency providing the square grid factory.
- **`dist/`** — Browserified output. `grid.js` (UMD bundle, browser global: `MitchAllen.Grid`) and `grid.min.js`. Generated by grunt, do not edit directly.

## Code Conventions

- CommonJS modules (`require`/`module.exports`), ES6 features (arrow functions, destructuring, `const`/`let`)
- `"use strict"` in all source files
- JSHint directives at top of files: `/*jshint node: true */` and `/*jshint esversion: 6 */`
- Factory pattern — grids are created via factory functions (e.g., `Square({ x: 5, y: 5 })`), not constructors
- Immutable public properties defined via `Object.defineProperties()`
- Tests use mocha with `should` assertion library (BDD style)
- Test files follow `*-smoke-test.js` / `*-test.js` naming pattern
